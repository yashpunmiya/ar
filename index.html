<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Compass</title>

    <!-- A-Frame and AR.js Libraries -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/ar.js/1.7.2/aframe/build/aframe-ar.js"></script>

    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        a-scene {
            width: 100%;
            height: 100%;
        }
        #compass {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            color: white;
            text-align: center;
        }
    </style>
</head>
<body>

<!-- Compass Display -->
<div id="compass">N</div>

<!-- A-Frame Scene -->
<a-scene embedded arjs="sourceType: webcam;">

    <!-- Camera -->
    <a-entity camera></a-entity>

    <!-- The compass arrow -->
    <a-entity id="compassArrow" geometry="primitive: cone; radiusBottom: 0; radiusTop: 0.1; height: 1.5"
              material="color: red; opacity: 0.7"
              position="0 0.75 -2"></a-entity>

</a-scene>

<script>
    // Function to update the compass direction based on device orientation
    function updateCompass() {
        // Get device orientation
        if (typeof DeviceOrientationEvent.requestPermission === 'function') {
            DeviceOrientationEvent.requestPermission()
                .then((response) => {
                    if (response == 'granted') {
                        window.addEventListener('deviceorientation', (event) => {
                            // Update compass arrow rotation
                            let alpha = event.alpha; // z-axis rotation
                            document.getElementById('compassArrow').setAttribute('rotation', `0 ${alpha} 0`);
                            // Update compass text
                            updateCompassDirection(alpha);
                        });
                    }
                })
                .catch(console.error);
        } else {
            // For browsers that don't require permissions
            window.addEventListener('deviceorientation', (event) => {
                let alpha = event.alpha;
                document.getElementById('compassArrow').setAttribute('rotation', `0 ${alpha} 0`);
                updateCompassDirection(alpha);
            });
        }
    }

    // Function to update the compass text
    function updateCompassDirection(alpha) {
        const compassText = document.getElementById('compass');
        if (alpha >= 315 || alpha < 45) {
            compassText.innerHTML = "N";
        } else if (alpha >= 45 && alpha < 135) {
            compassText.innerHTML = "E";
        } else if (alpha >= 135 && alpha < 225) {
            compassText.innerHTML = "S";
        } else if (alpha >= 225 && alpha < 315) {
            compassText.innerHTML = "W";
        }
    }

    // Start the compass when the page is loaded
    window.onload = function () {
        updateCompass();
    };
</script>

</body>
</html>
